{"version":3,"file":"all-pages-detail.repository-Cfm1_mzl.js","sources":["../../../../Umbraco.Community.ContentAudit.UI/src/section/all-pages/repository/detail/all-pages-detail.server.data-source.ts","../../../../Umbraco.Community.ContentAudit.UI/src/section/all-pages/repository/detail/all-pages-detail.repository.ts"],"sourcesContent":["import { UmbReadDetailDataSource } from \"@umbraco-cms/backoffice/repository\";\r\nimport { AuditService, PageAnalysisDto } from \"../../../../api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { tryExecuteAndNotify } from \"@umbraco-cms/backoffice/resources\";\r\n\r\nexport class ContentAuditAllPagesServerDataSource implements UmbReadDetailDataSource<PageAnalysisDto> {\r\n\t#host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync read(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst { data, error } = await tryExecuteAndNotify(\r\n\t\t\tthis.#host,\r\n\t\t\tAuditService.getLatestPageAuditData({ unique: unique })\r\n\t\t);\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\treturn { data: data };\r\n\t}\r\n}","import { UmbReadDetailRepository, UmbRepositoryBase } from \"@umbraco-cms/backoffice/repository\";\r\nimport { PageAnalysisDto } from \"../../../../api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { CONTENT_AUDIT_ALL_PAGES_DETAIL_STORE_CONTEXT } from \"./all-pages-detail.store\";\r\nimport { ContentAuditAllPagesServerDataSource } from \"./all-pages-detail.server.data-source\";\r\nimport { UmbDetailStore } from \"@umbraco-cms/backoffice/store\";\r\n\r\nexport class ContentAuditAllPagesDetailRepository extends UmbRepositoryBase implements UmbReadDetailRepository<PageAnalysisDto> {\r\n\r\n    #init: Promise<unknown>;\r\n    #detailStore?: UmbDetailStore<PageAnalysisDto>;\r\n    #detailSource = new ContentAuditAllPagesServerDataSource(this);\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host);\r\n\r\n        this.#init = Promise.all([\r\n            this.consumeContext(CONTENT_AUDIT_ALL_PAGES_DETAIL_STORE_CONTEXT, (instance) => {\r\n                this.#detailStore = instance;\r\n            }).asPromise(),\r\n        ]);\r\n    }\r\n\r\n    async requestByUnique(unique: string) {\r\n        if (!unique) throw new Error('Unique is missing');\r\n        await this.#init;\r\n\r\n        const { data, error } = await this.#detailSource.read(unique);\r\n\r\n        if (data) {\r\n            this.#detailStore!.append(data);\r\n        }\r\n\r\n        return { data, error, asObservable: () => this.#detailStore!.byUnique(unique) };\r\n    }\r\n\r\n    async byUnique(unique: string) {\r\n        if (!unique) throw new Error('Unique is missing');\r\n        await this.#init;\r\n        return this.#detailStore!.byUnique(unique);\r\n    }\r\n}\r\n\r\nexport default ContentAuditAllPagesDetailRepository;"],"names":["ContentAuditAllPagesServerDataSource","host","__privateAdd","_host","__privateSet","unique","data","error","tryExecuteAndNotify","__privateGet","AuditService","ContentAuditAllPagesDetailRepository","UmbRepositoryBase","_init","_detailStore","_detailSource","CONTENT_AUDIT_ALL_PAGES_DETAIL_STORE_CONTEXT","instance"],"mappings":";;;;;;;;;;AAKO,MAAMA,EAAyF;AAAA,EAGrG,YAAYC,GAAyB;AAFrC,IAAAC,EAAA,MAAAC;AAGC,IAAAC,EAAA,MAAKD,GAAQF;AAAA,EAAA;AAAA,EAGd,MAAM,KAAKI,GAAgB;AAC1B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAEhD,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7BC,EAAA,MAAKN;AAAA,MACLO,EAAa,uBAAuB,EAAE,QAAAL,EAAgB,CAAA;AAAA,IACvD;AAEI,WAAAE,KAAS,CAACD,IACN,EAAE,OAAAC,EAAM,IAGT,EAAE,MAAAD,EAAW;AAAA,EAAA;AAEtB;AApBCH,IAAA;;ACCM,MAAMQ,UAA6CC,EAAsE;AAAA,EAM5H,YAAYX,GAAyB;AACjC,UAAMA,CAAI;AALd,IAAAC,EAAA,MAAAW;AACA,IAAAX,EAAA,MAAAY;AACA,IAAAZ,EAAA,MAAAa,GAAgB,IAAIf,EAAqC,IAAI;AAKpD,IAAAI,EAAA,MAAAS,GAAQ,QAAQ,IAAI;AAAA,MACrB,KAAK,eAAeG,GAA8C,CAACC,MAAa;AAC5E,QAAAb,EAAA,MAAKU,GAAeG;AAAA,MACvB,CAAA,EAAE,UAAU;AAAA,IAAA,CAChB;AAAA,EAAA;AAAA,EAGL,MAAM,gBAAgBZ,GAAgB;AAClC,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAChD,UAAMI,EAAA,MAAKI;AAEL,UAAA,EAAE,MAAAP,GAAM,OAAAC,EAAM,IAAI,MAAME,EAAA,MAAKM,GAAc,KAAKV,CAAM;AAE5D,WAAIC,KACKG,EAAA,MAAAK,GAAc,OAAOR,CAAI,GAG3B,EAAE,MAAAA,GAAM,OAAAC,GAAO,cAAc,MAAME,EAAA,MAAKK,GAAc,SAAST,CAAM,EAAE;AAAA,EAAA;AAAA,EAGlF,MAAM,SAASA,GAAgB;AAC3B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAChD,iBAAMI,EAAA,MAAKI,IACJJ,EAAA,MAAKK,GAAc,SAAST,CAAM;AAAA,EAAA;AAEjD;AAhCIQ,IAAA,eACAC,IAAA,eACAC,IAAA;"}