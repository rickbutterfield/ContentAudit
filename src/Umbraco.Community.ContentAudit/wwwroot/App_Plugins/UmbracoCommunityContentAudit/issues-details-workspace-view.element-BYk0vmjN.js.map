{"version":3,"file":"issues-details-workspace-view.element-BYk0vmjN.js","sources":["../../../../Umbraco.Community.ContentAudit.UI/src/section/issues/workspace/issues/views/issues-details-workspace-view.element.ts"],"sourcesContent":["import { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { UMB_WORKSPACE_MODAL, UmbWorkspaceViewElement } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { customElement, state } from \"lit/decorators.js\";\r\nimport { CONTENT_AUDIT_ISSUES_WORKSPACE_CONTEXT } from \"../issues-workspace.context\";\r\nimport { IssueDto } from \"../../../../../api\";\r\nimport { css, html } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN } from '@umbraco-cms/backoffice/document';\r\nimport { UmbTextStyles } from \"@umbraco-cms/backoffice/style\";\r\nimport { UmbTableConfig, UmbTableColumn, UmbTableItem } from \"../../../../../interfaces\";\r\nimport { UmbModalRouteBuilder, UmbModalRouteRegistrationController } from \"@umbraco-cms/backoffice/router\";\r\n\r\n@customElement('content-audit-issues-details-workspace-view')\r\nexport class ContentAuditIssuesDetailsWorkspaceViewElement extends UmbLitElement implements UmbWorkspaceViewElement {\r\n    @state()\r\n    _data?: IssueDto;\r\n\r\n    @state()\r\n    private _tableConfig: UmbTableConfig = {\r\n        allowSelection: false,\r\n        hideIcon: true\r\n    };\r\n\r\n    @state()\r\n    private get _tableColumns(): Array<UmbTableColumn> {\r\n        let columns: UmbTableColumn[] = [];\r\n\r\n        if (this._data != null) {\r\n            columns.push({\r\n                name: this._data?.images != null ? 'URL' : 'Page',\r\n                alias: 'url'\r\n            });\r\n\r\n            if (this._data?.exposedProperties != null) {\r\n                if (this._data?.exposedProperties?.length !== 0) {\r\n                    this._data.exposedProperties.forEach(x => {\r\n                        columns.push({ name: x.name!, alias: x.alias!, elementName: x.elementName!, labelTemplate: x.labelTemplate! });\r\n                    })\r\n                }\r\n            }\r\n\r\n            if (this._data?.images != null) {\r\n                if (this._data?.images?.length !== 0) {\r\n                    columns.push({\r\n                        name: 'Found Page',\r\n                        alias: 'foundPage'\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return columns;\r\n    };\r\n\r\n    @state()\r\n    private _tableItems: Array<UmbTableItem> = [];\r\n\r\n    #workspaceContext?: typeof CONTENT_AUDIT_ISSUES_WORKSPACE_CONTEXT.TYPE;\r\n    #routeBuilder?: UmbModalRouteBuilder;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(CONTENT_AUDIT_ISSUES_WORKSPACE_CONTEXT, (instance) => {\r\n            this.#workspaceContext = instance;\r\n        });\r\n\r\n        this.#registerModalRoute();\r\n    }\r\n\r\n    #registerModalRoute() {\r\n        new UmbModalRouteRegistrationController(this, UMB_WORKSPACE_MODAL)\r\n            .addAdditionalPath(':entityType')\r\n            .onSetup((params) => {\r\n                return { data: { entityType: params.entityType, preset: {} } };\r\n            })\r\n            .observeRouteBuilder((routeBuilder) => {\r\n                this.#routeBuilder = routeBuilder;\r\n\r\n                this.#observeCollectionItems();\r\n            });\r\n    }\r\n\r\n    #observeCollectionItems() {\r\n        if (!this.#workspaceContext) return;\r\n        this.observe(this.#workspaceContext.data, (data) => {\r\n            this._data = data;\r\n            this.#createTableItems(data);\r\n        }, 'umbCollectionItemsObserver');\r\n    }\r\n\r\n    #createTableItems(data: IssueDto | undefined) {\r\n        let tableItems: UmbTableItem[] | undefined = [];\r\n\r\n        const routeBuilder = this.#routeBuilder;\r\n        if (!routeBuilder) throw new Error('Route builder not ready');\r\n\r\n        if (data != null) {\r\n            if (data.pages?.length !== 0) {\r\n                tableItems = data?.pages?.map((page) => {\r\n                    const modalEditPath =\r\n                        routeBuilder({ entityType: 'document' }) +\r\n                        UMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN.generateLocal({ unique: page.unique! });\r\n\r\n                    let tableItem: UmbTableItem = {\r\n                        id: page.unique,\r\n                        data: [\r\n                            {\r\n                                columnAlias: 'url',\r\n                                value: html`<a href=\"${modalEditPath}\">${page.pageData?.url}</a>`\r\n                            }\r\n                        ]\r\n                    };\r\n\r\n                    if (this._data?.exposedProperties != null) {\r\n                        if (this._data?.exposedProperties?.length !== 0) {\r\n                            this._data.exposedProperties.forEach(x => {\r\n                                const aliasParts = x.alias!.split('.');\r\n                                let value = page as any;\r\n                                for (const part of aliasParts) {\r\n                                    if (value && typeof value === 'object') {\r\n                                        value = value[part];\r\n                                    } else {\r\n                                        break;\r\n                                    }\r\n                                }\r\n\r\n                                tableItem.data.push({ columnAlias: x.alias!, value: value });\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    return tableItem;\r\n                });\r\n            }\r\n\r\n            if (data?.images != null) {\r\n                if (data?.images.length !== 0) {\r\n                    tableItems = data?.images?.map((page) => {\r\n                        let tableItem: UmbTableItem = {\r\n                            id: page.unique,\r\n                            data: [\r\n                                {\r\n                                    columnAlias: 'url',\r\n                                    value: page.url\r\n                                },\r\n                                {\r\n                                    columnAlias: 'foundPage',\r\n                                    value: page.foundPage\r\n                                }\r\n                            ]\r\n                        }\r\n\r\n                        return tableItem;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        this._tableItems = tableItems || [];\r\n    }\r\n\r\n    #renderPages() {\r\n        return html`\r\n\t\t\t<div>\r\n\t\t\t\t<umb-table\r\n\t\t\t\t\t.config=${this._tableConfig}\r\n\t\t\t\t\t.columns=${this._tableColumns}\r\n\t\t\t\t\t.items=${this._tableItems}>\r\n\t\t\t\t</umb-table>\r\n\t\t\t</div>\r\n\t\t`\r\n    }\r\n\r\n    #renderProperties() {\r\n        return html`\r\n\t\t\t<uui-box style=\"align-self: flex-start;\">\r\n\t\t\t\t<umb-property-layout label=\"Name\" orientation=\"vertical\" style=\"padding-top: 0;\">\r\n\t\t\t\t\t<div slot=\"editor\">${this._data?.name}</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t\t<umb-property-layout label=\"Category\" orientation=\"vertical\">\r\n\t\t\t\t\t<div slot=\"editor\">${this._data?.category}</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t\t<umb-property-layout label=\"Description\" orientation=\"vertical\">\r\n\t\t\t\t\t<div slot=\"editor\">${this._data?.description}</div>\r\n\t\t\t\t</umb-property-layout>\r\n\r\n\t\t\t\t<umb-property-layout label=\"Issue Type\" orientation=\"vertical\">\r\n\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t<content-audit-issue-type-label .type=${this._data?.type}></content-audit-issue-type-label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t\t<umb-property-layout label=\"Issue Priority\" orientation=\"vertical\" style=\"padding-bottom: 0;\">\r\n\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t<content-audit-priority-type-label .type=${this._data?.priority}></content-audit-priority-type-label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t</uui-box>\r\n\t\t`\r\n    }\r\n\r\n    override render() {\r\n        return html`\r\n\t\t\t${this.#renderPages()}\r\n\t\t\t${this.#renderProperties()}\r\n\t\t`\r\n    }\r\n\r\n    static override styles = [\r\n        UmbTextStyles,\r\n        css`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: var(--uui-size-layout-1);\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t\tgrid-template-columns: 1fr 350px;\r\n\t\t\t}\r\n\t\t`\r\n    ]\r\n}\r\n\r\nexport default ContentAuditIssuesDetailsWorkspaceViewElement;\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'content-audit-issues-details-workspace-view': ContentAuditIssuesDetailsWorkspaceViewElement;\r\n    }\r\n}\r\n"],"names":["_workspaceContext","_routeBuilder","_ContentAuditIssuesDetailsWorkspaceViewElement_instances","registerModalRoute_fn","observeCollectionItems_fn","createTableItems_fn","renderPages_fn","renderProperties_fn","ContentAuditIssuesDetailsWorkspaceViewElement","UmbLitElement","__privateAdd","CONTENT_AUDIT_ISSUES_WORKSPACE_CONTEXT","instance","__privateSet","__privateMethod","columns","_a","_b","_d","_c","x","_e","_g","_f","html","UmbModalRouteRegistrationController","UMB_WORKSPACE_MODAL","params","routeBuilder","__privateGet","data","tableItems","page","modalEditPath","UMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN","tableItem","aliasParts","value","part","UmbTextStyles","css","__decorateClass","state","customElement","ContentAuditIssuesDetailsWorkspaceViewElement$1"],"mappings":"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"}