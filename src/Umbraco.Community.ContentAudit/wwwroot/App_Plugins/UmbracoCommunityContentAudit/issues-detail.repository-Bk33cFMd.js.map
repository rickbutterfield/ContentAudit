{"version":3,"file":"issues-detail.repository-Bk33cFMd.js","sources":["../../../../Umbraco.Community.ContentAudit.UI/src/section/issues/repository/detail/issues-detail.server.data-source.ts","../../../../Umbraco.Community.ContentAudit.UI/src/section/issues/repository/detail/issues-detail.repository.ts"],"sourcesContent":["import { UmbReadDetailDataSource } from \"@umbraco-cms/backoffice/repository\";\r\nimport { AuditService, IssueDto } from \"../../../../api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { tryExecuteAndNotify } from \"@umbraco-cms/backoffice/resources\";\r\n\r\nexport class ContentAuditIssuesServerDataSource implements UmbReadDetailDataSource<IssueDto> {\r\n    #host: UmbControllerHost;\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        this.#host = host;\r\n    }\r\n\r\n\tasync read(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst { data, error } = await tryExecuteAndNotify(\r\n\t\t\tthis.#host,\r\n\t\t\tAuditService.getIssue({ issueGuid: unique })\r\n\t\t);\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\treturn { data: data };\r\n\t}\r\n}","import { UmbReadDetailRepository, UmbRepositoryBase } from \"@umbraco-cms/backoffice/repository\";\r\nimport { IssueDto } from \"../../../../api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { CONTENT_AUDIT_ISSUES_DETAIL_STORE_CONTEXT } from \"./issues-detail.store\";\r\nimport { ContentAuditIssuesServerDataSource } from \"./issues-detail.server.data-source\";\r\nimport { UmbDetailStore } from \"@umbraco-cms/backoffice/store\";\r\n\r\nexport class ContentAuditIssuesDetailRepository extends UmbRepositoryBase implements UmbReadDetailRepository<IssueDto> {\r\n\r\n    #init: Promise<unknown>;\r\n    #detailStore?: UmbDetailStore<IssueDto>;\r\n    #detailSource = new ContentAuditIssuesServerDataSource(this);\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host);\r\n\r\n        this.#init = Promise.all([\r\n            this.consumeContext(CONTENT_AUDIT_ISSUES_DETAIL_STORE_CONTEXT, (instance) => {\r\n                this.#detailStore = instance;\r\n            }).asPromise(),\r\n        ]);\r\n    }\r\n\r\n    async requestByUnique(unique: string) {\r\n        if (!unique) throw new Error('Unique is missing');\r\n        await this.#init;\r\n\r\n        const { data, error } = await this.#detailSource.read(unique);\r\n\r\n        if (data) {\r\n            this.#detailStore!.append(data);\r\n        }\r\n\r\n        return { data, error, asObservable: () => this.#detailStore!.byUnique(unique) };\r\n    }\r\n\r\n    async byUnique(unique: string) {\r\n        if (!unique) throw new Error('Unique is missing');\r\n        await this.#init;\r\n        return this.#detailStore!.byUnique(unique);\r\n    }\r\n}\r\n\r\nexport default ContentAuditIssuesDetailRepository;"],"names":["ContentAuditIssuesServerDataSource","host","__privateAdd","_host","__privateSet","unique","data","error","tryExecuteAndNotify","__privateGet","AuditService","ContentAuditIssuesDetailRepository","UmbRepositoryBase","_init","_detailStore","_detailSource","CONTENT_AUDIT_ISSUES_DETAIL_STORE_CONTEXT","instance"],"mappings":";;;;;;;;;;AAKO,MAAMA,EAAgF;AAAA,EAGzF,YAAYC,GAAyB;AAFrC,IAAAC,EAAA,MAAAC;AAGI,IAAAC,EAAA,MAAKD,GAAQF;AAAA,EAAA;AAAA,EAGpB,MAAM,KAAKI,GAAgB;AAC1B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAEhD,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7BC,EAAA,MAAKN;AAAA,MACLO,EAAa,SAAS,EAAE,WAAWL,EAAQ,CAAA;AAAA,IAC5C;AAEI,WAAAE,KAAS,CAACD,IACN,EAAE,OAAAC,EAAM,IAGT,EAAE,MAAAD,EAAW;AAAA,EAAA;AAEtB;AApBIH,IAAA;;ACCG,MAAMQ,UAA2CC,EAA+D;AAAA,EAMnH,YAAYX,GAAyB;AACjC,UAAMA,CAAI;AALd,IAAAC,EAAA,MAAAW;AACA,IAAAX,EAAA,MAAAY;AACA,IAAAZ,EAAA,MAAAa,GAAgB,IAAIf,EAAmC,IAAI;AAKlD,IAAAI,EAAA,MAAAS,GAAQ,QAAQ,IAAI;AAAA,MACrB,KAAK,eAAeG,GAA2C,CAACC,MAAa;AACzE,QAAAb,EAAA,MAAKU,GAAeG;AAAA,MACvB,CAAA,EAAE,UAAU;AAAA,IAAA,CAChB;AAAA,EAAA;AAAA,EAGL,MAAM,gBAAgBZ,GAAgB;AAClC,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAChD,UAAMI,EAAA,MAAKI;AAEL,UAAA,EAAE,MAAAP,GAAM,OAAAC,EAAM,IAAI,MAAME,EAAA,MAAKM,GAAc,KAAKV,CAAM;AAE5D,WAAIC,KACKG,EAAA,MAAAK,GAAc,OAAOR,CAAI,GAG3B,EAAE,MAAAA,GAAM,OAAAC,GAAO,cAAc,MAAME,EAAA,MAAKK,GAAc,SAAST,CAAM,EAAE;AAAA,EAAA;AAAA,EAGlF,MAAM,SAASA,GAAgB;AAC3B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAChD,iBAAMI,EAAA,MAAKI,IACJJ,EAAA,MAAKK,GAAc,SAAST,CAAM;AAAA,EAAA;AAEjD;AAhCIQ,IAAA,eACAC,IAAA,eACAC,IAAA;"}